"use strict";window.setImmediate||(window.setImmediate=window.msSetImmediate||window.webkitSetImmediate||window.mozSetImmediate||window.oSetImmediate||function(){if(!window.postMessage||!window.addEventListener)return null;var a=[void 0],i="zero-timeout-message";return window.addEventListener("message",function(t){var e;"string"==typeof t.data&&t.data.substr(0,i.length)===i&&(t.stopImmediatePropagation(),e=parseInt(t.data.substr(i.length),36),a[e]&&(a[e](),a[e]=void 0))},!0),window.clearImmediate=function(t){a[t]&&(a[t]=void 0)},function(t){var e=a.length;return a.push(t),window.postMessage(i+e.toString(36),"*"),e}}()||function(t){window.setTimeout(t,0)}),window.clearImmediate||(window.clearImmediate=window.msClearImmediate||window.webkitClearImmediate||window.mozClearImmediate||window.oClearImmediate||function(t){window.clearTimeout(t)}),function(t){function e(p,t){if(o){Array.isArray(p)||(p=[p]),p.forEach(function(t,e){if("string"==typeof t){if(p[e]=document.getElementById(t),!p[e])throw"The element id specified is not found."}else if(!t.tagName&&!t.appendChild)throw"You must pass valid HTML elements, or ID of the element."});var e,S={list:[],fontFamily:'"Trebuchet MS", "Heiti TC", "微軟正黑體", "Arial Unicode MS", "Droid Fallback Sans", sans-serif',fontWeight:"normal",color:"random-dark",minSize:0,weightFactor:1,clearCanvas:!0,backgroundColor:"#fff",gridSize:8,drawOutOfBound:!1,shrinkToFit:!1,origin:null,drawMask:!1,maskColor:"rgba(255,0,0,0.3)",maskGapWidth:.3,wait:0,abortThreshold:0,abort:function(){},minRotation:-Math.PI/2,maxRotation:Math.PI/2,rotationSteps:0,shuffle:!0,rotateRatio:.1,shape:"circle",ellipticity:.65,classes:null,hover:null,click:null};if(t)for(var a in t)a in S&&(S[a]=t[a]);if("function"!=typeof S.weightFactor&&(e=S.weightFactor,S.weightFactor=function(t){return t*e}),"function"!=typeof S.shape)switch(S.shape){case"circle":default:S.shape="circle";break;case"cardioid":S.shape=function(t){return 1-Math.sin(t)};break;case"diamond":S.shape=function(t){var e=t%(2*Math.PI/4);return 1/(Math.cos(e)+Math.sin(e))};break;case"square":S.shape=function(t){return Math.min(1/Math.abs(Math.cos(t)),1/Math.abs(Math.sin(t)))};break;case"triangle-forward":S.shape=function(t){var e=t%(2*Math.PI/3);return 1/(Math.cos(e)+Math.sqrt(3)*Math.sin(e))};break;case"triangle":case"triangle-upright":S.shape=function(t){var e=(t+3*Math.PI/2)%(2*Math.PI/3);return 1/(Math.cos(e)+Math.sqrt(3)*Math.sin(e))};break;case"pentagon":S.shape=function(t){var e=(t+.955)%(2*Math.PI/5);return 1/(Math.cos(e)+.726543*Math.sin(e))};break;case"star":S.shape=function(t){var e=(t+.955)%(2*Math.PI/10);return 0<=(t+.955)%(2*Math.PI/5)-2*Math.PI/10?1/(Math.cos(2*Math.PI/10-e)+3.07768*Math.sin(2*Math.PI/10-e)):1/(Math.cos(e)+3.07768*Math.sin(e))}}S.gridSize=Math.max(Math.floor(S.gridSize),4);var x,b,T,w,g,v,M,E,F=S.gridSize,I=F-S.maskGapWidth,c=Math.abs(S.maxRotation-S.minRotation),h=Math.abs(Math.floor(S.rotationSteps)),u=Math.min(S.maxRotation,S.minRotation);switch(S.color){case"random-dark":M=function(){return r(10,50)};break;case"random-light":M=function(){return r(50,90)};break;default:"function"==typeof S.color&&(M=S.color)}"function"==typeof S.fontWeight&&(E=S.fontWeight);var k=null;"function"==typeof S.classes&&(k=S.classes);var y,C=!1,P=[],i=function(t){var e,a=t.currentTarget,i=a.getBoundingClientRect(),r=t.touches?(e=t.touches[0].clientX,t.touches[0].clientY):(e=t.clientX,t.clientY),o=e-i.left,n=r-i.top,s=Math.floor(o*(a.width/i.width||1)/F),l=Math.floor(n*(a.height/i.height||1)/F);return P[s][l]},R=function(t){var e=i(t);y!==e&&((y=e)?S.hover(e.item,e.dimension,t):S.hover(void 0,void 0,t))},O=function(t){var e=i(t);e&&(S.click(e.item,e.dimension,t),t.preventDefault())},m=[],z=function(){return 0<S.abortThreshold&&(new Date).getTime()-v>S.abortThreshold},A=function(t,e,a,i,r,o){var n,s,l,d=r.occupied,f=S.drawMask;f&&((n=p[0].getContext("2d")).save(),n.fillStyle=S.maskColor),C&&(l={x:(t+(s=r.bounds)[3])*F,y:(e+s[0])*F,w:(s[1]-s[3]+1)*F,h:(s[2]-s[0]+1)*F});for(var c,h,u,m,w,g=d.length;g--;){var v=t+d[g][0],M=e+d[g][1];b<=v||T<=M||v<0||M<0||(h=M,u=f,m=l,w=o,b<=(c=v)||T<=h||c<0||h<0||(x[c][h]=!1,u&&p[0].getContext("2d").fillRect(c*F,h*F,I,I),C&&(P[c][h]={item:w,dimension:m})))}f&&n.restore()},W=function t(i){var r,o,n;Array.isArray(i)?(r=i[0],o=i[1]):(r=i.word,o=i.weight,n=i.attributes);var s=0===S.rotateRatio||Math.random()>S.rotateRatio?0:0===c?u:0<h?u+Math.floor(Math.random()*h)*c/(h-1):u+Math.random()*c,l=function(t,e,a){var i=S.weightFactor(e);if(i<=S.minSize)return!1;var r,o=1;i<D&&(o=function(){for(var t=2;t*i<D;)t+=2;return t}()),r=E?E(t,e,i):S.fontWeight;var n=document.createElement("canvas"),s=n.getContext("2d",{willReadFrequently:!0});s.font=r+" "+(i*o).toString(10)+"px "+S.fontFamily;var l=s.measureText(t).width/o,d=Math.max(i*o,s.measureText("m").width,s.measureText("Ｗ").width)/o,f=l+2*d,c=3*d,h=Math.ceil(f/F),u=Math.ceil(c/F),f=h*F,c=u*F,m=-l/2,w=.4*-d,g=Math.ceil((f*Math.abs(Math.sin(a))+c*Math.abs(Math.cos(a)))/F),v=Math.ceil((f*Math.abs(Math.cos(a))+c*Math.abs(Math.sin(a)))/F),M=v*F,p=g*F;n.setAttribute("width",M),n.setAttribute("height",p),s.scale(1/o,1/o),s.translate(M*o/2,p*o/2),s.rotate(-a),s.font=r+" "+(i*o).toString(10)+"px "+S.fontFamily,s.fillStyle="#000",s.textBaseline="middle",s.fillText(t,m*o,(w+.5*i)*o);var x=s.getImageData(0,0,M,p).data;if(z())return!1;for(var b,T,I,k=[],y=v,C=[g/2,v/2,g/2,v/2];y--;)for(b=g;b--;){I=F;t:{for(;I--;)for(T=F;T--;)if(x[4*((b*F+I)*M+(y*F+T))+3]){k.push([y,b]),y<C[3]&&(C[3]=y),y>C[1]&&(C[1]=y),b<C[0]&&(C[0]=b),b>C[2]&&(C[2]=b);break t}0}}return{mu:o,occupied:k,bounds:C,gw:v,gh:g,fillTextOffsetX:m,fillTextOffsetY:w,fillTextWidth:l,fillTextHeight:d,fontSize:i}}(r,o,s);if(!l)return!1;if(z())return!1;if(!S.drawOutOfBound){var e=l.bounds;if(e[1]-e[3]+1>b||e[2]-e[0]+1>T)return!1}for(var d=g+1,a=function(t){var e=Math.floor(t[0]-l.gw/2),a=Math.floor(t[1]-l.gh/2);l.gw,l.gh;return!!function(t,e,a){for(var i=a.length;i--;){var r=t+a[i][0],o=e+a[i][1];if(b<=r||T<=o||r<0||o<0){if(!S.drawOutOfBound)return!1}else if(!x[r][o])return!1}return!0}(e,a,l.occupied)&&(function(l,d,f,c,t,e,a,h,u){var m=f.fontSize,w=M?M(c,t,m,e,a):S.color,g=E?E(c,t,m):S.fontWeight,v=k?k(c,t,m):S.classes,i=f.bounds;i[3],i[0],i[1],i[3],i[2],i[0];p.forEach(function(t){if(t.getContext){var e=t.getContext("2d"),a=f.mu;e.save(),e.scale(1/a,1/a),e.font=g+" "+(m*a).toString(10)+"px "+S.fontFamily,e.fillStyle=w,e.translate((l+f.gw/2)*F*a,(d+f.gh/2)*F*a),0!==h&&e.rotate(-h),e.textBaseline="middle",e.fillText(c,f.fillTextOffsetX*a,(f.fillTextOffsetY+.5*m)*a),e.restore()}else{var i=document.createElement("span"),r="",r="rotate("+-h/Math.PI*180+"deg) ";1!==f.mu&&(r+="translateX(-"+f.fillTextWidth/4+"px) scale("+1/f.mu+")");var o={position:"absolute",display:"block",font:g+" "+m*f.mu+"px "+S.fontFamily,left:(l+f.gw/2)*F+f.fillTextOffsetX+"px",top:(d+f.gh/2)*F+f.fillTextOffsetY+"px",width:f.fillTextWidth+"px",height:f.fillTextHeight+"px",lineHeight:m+"px",whiteSpace:"nowrap",transform:r,webkitTransform:r,msTransform:r,transformOrigin:"50% 40%",webkitTransformOrigin:"50% 40%",msTransformOrigin:"50% 40%"};for(var n in w&&(o.color=w),i.textContent=c,o)i.style[n]=o[n];if(u)for(var s in u)i.setAttribute(s,u[s]);v&&(i.className+=v),t.appendChild(i)}})}(e,a,l,r,o,g-d,t[2],s,n),A(e,a,0,0,l,i),!0)};d--;){var f=function(t){if(m[t])return m[t];var e=8*t,a=e,i=[];for(0===t&&i.push([w[0],w[1],0]);a--;){var r=1;"circle"!==S.shape&&(r=S.shape(a/e*2*Math.PI)),i.push([w[0]+t*r*Math.cos(-a/e*2*Math.PI),w[1]+t*r*Math.sin(-a/e*2*Math.PI)*S.ellipticity,a/e*2*Math.PI])}return m[t]=i}(g-d);if(S.shuffle&&function(t){for(var e,a,i=t.length;i;e=Math.floor(Math.random()*i),a=t[--i],t[i]=t[e],t[e]=a);}(f=[].concat(f)),f.some(a))return!0}return!!S.shrinkToFit&&(Array.isArray(i)?i[1]=3*i[1]/4:i.weight=3*i.weight/4,t(i))},L=function(a,t,i){if(t)return!p.some(function(t){var e=new CustomEvent(a,{detail:i||{}});return!t.dispatchEvent(e)},this);p.forEach(function(t){var e=new CustomEvent(a,{detail:i||{}});t.dispatchEvent(e)},this)};!function(){var t,e,i,r,o,a=p[0];if(T=a.getContext?(b=Math.ceil(a.width/F),Math.ceil(a.height/F)):(t=a.getBoundingClientRect(),b=Math.ceil(t.width/F),Math.ceil(t.height/F)),L("wordcloudstart",!0)){if(w=S.origin?[S.origin[0]/F,S.origin[1]/F]:[b/2,T/2],g=Math.floor(Math.sqrt(b*b+T*T)),x=[],!a.getContext||S.clearCanvas)for(p.forEach(function(t){var e;t.getContext?((e=t.getContext("2d")).fillStyle=S.backgroundColor,e.clearRect(0,0,b*(F+1),T*(F+1)),e.fillRect(0,0,b*(F+1),T*(F+1))):(t.textContent="",t.style.backgroundColor=S.backgroundColor,t.style.position="relative")}),c=b;c--;)for(x[c]=[],e=T;e--;)x[c][e]=!0;else{var n=document.createElement("canvas").getContext("2d");n.fillStyle=S.backgroundColor,n.fillRect(0,0,1,1);for(var s,l,d=n.getImageData(0,0,1,1).data,f=a.getContext("2d").getImageData(0,0,b*F,T*F).data,c=b;c--;)for(x[c]=[],e=T;e--;){l=F;t:for(;l--;)for(s=F;s--;)for(i=4;i--;)if(f[4*((e*F+l)*b*F+(c*F+s))+i]!==d[i]){x[c][e]=!1;break t}!1!==x[c][e]&&(x[c][e]=!0)}f=n=d=void 0}if(S.hover||S.click){for(C=!0,c=b+1;c--;)P[c]=[];S.hover&&a.addEventListener("mousemove",R),S.click&&(a.addEventListener("click",O),a.style.webkitTapHighlightColor="rgba(0, 0, 0, 0)"),a.addEventListener("wordcloudstart",function t(){a.removeEventListener("wordcloudstart",t),a.removeEventListener("mousemove",R),a.removeEventListener("click",O),y=void 0})}o=(i=0)!==S.wait?(r=window.setTimeout,window.clearTimeout):(r=window.setImmediate,window.clearImmediate);var h=function(e,a){p.forEach(function(t){t.removeEventListener(e,a)},this)},u=function t(){h("wordcloudstart",t),o(m)};!function(e,a){p.forEach(function(t){t.addEventListener(e,a)},this)}("wordcloudstart",u);var m=r(function t(){if(i>=S.list.length)return o(m),L("wordcloudstop",!1),void h("wordcloudstart",u);v=(new Date).getTime();var e=W(S.list[i]),a=!L("wordclouddrawn",!0,{item:S.list[i],drawn:e});if(z()||a)return o(m),S.abort(),L("wordcloudabort",!1),L("wordcloudstop",!1),void h("wordcloudstart",u);i++,m=r(t,S.wait)},S.wait)}}()}function r(t,e){return"hsl("+(360*Math.random()).toFixed()+","+(30*Math.random()+70).toFixed()+"%,"+(Math.random()*(e-t)+t).toFixed()+"%)"}}var o=function(){var t=document.createElement("canvas");if(!t||!t.getContext)return!1;var e=t.getContext("2d");return!!e&&(!!e.getImageData&&(!!e.fillText&&(!!Array.prototype.some&&!!Array.prototype.push)))}(),D=function(){if(o){for(var t,e,a=document.createElement("canvas").getContext("2d"),i=20;i;){if(a.font=i.toString(10)+"px sans-serif",a.measureText("Ｗ").width===t&&a.measureText("m").width===e)return i+1;t=a.measureText("Ｗ").width,e=a.measureText("m").width,i--}return 0}}();e.isSupported=o,e.minFontSize=D,"function"==typeof define&&define.amd?(t.WordCloud=e,define("wordcloud",[],function(){return e})):"undefined"!=typeof module&&module.exports?module.exports=e:t.WordCloud=e}(this);